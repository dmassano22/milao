:root{
  --bg: url('');
  --blur: 8px;
  --fg: #f4f4f4;
  --ink: #0f0f10;
  --accent: #d7b26d;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
body{background:#000;color:var(--fg)}
.hidden{display:none!important}
.show{opacity:1}
.fade-out{opacity:0;transition:opacity .45s ease}
.gone{display:none!important}
.pointer-off{pointer-events:none!important}

/* screens */
.screen{display:none;position:fixed;inset:0;background:#000 center/cover no-repeat;background-image:var(--bg)}
.screen.active{display:flex;justify-content:center;align-items:center;padding:24px}

/* card */
.wrap{width:min(960px,95vw);background:rgba(0,0,0,.35);padding:32px 28px;border-radius:16px;box-shadow:0 12px 48px rgba(0,0,0,.55);margin:auto}
.glass{backdrop-filter:blur(var(--blur))}
h1,h2{margin:0 0 14px 0;font-size:2.2rem}
p{line-height:1.6;font-size:1.1rem}

.btn{background:transparent;color:#fff;border:1.5px solid #fff;padding:12px 20px;border-radius:12px;cursor:pointer;transition:.2s;font-weight:600;font-size:1rem}
.btn:hover{transform:translateY(-1px);border-color:var(--accent);color:var(--accent)}
.btn:disabled{opacity:.4;cursor:not-allowed}
.hint,.tip{opacity:.8;font-size:1rem}
.flavour{opacity:.9;font-style:italic;margin-bottom:12px}
.nav-buttons{display:flex;justify-content:flex-end;gap:10px;margin-top:16px}
.btn-back{border-color:#aaa;color:#aaa}

/* ==== INTRO (efeitos) ==== */
#intro{position:relative;overflow:hidden;animation:zoomBg 18s ease-in-out infinite alternate}
@keyframes zoomBg{0%{background-size:100%;filter:brightness(1)}100%{background-size:106%;filter:brightness(1.08)}}
#intro::before{content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(120% 70% at 50% 20%, rgba(255,255,255,.02), transparent 55%),radial-gradient(90% 60% at 60% 80%, rgba(255,255,255,.015), transparent 60%);animation:fogShift 22s ease-in-out infinite alternate}
@keyframes fogShift{0%{transform:translateY(0)}100%{transform:translateY(-10px)}}
.intro-overlay{position:absolute;inset:0;pointer-events:none}
.intro-symbol{position:absolute;opacity:.06;filter:blur(1px);width:84px;height:auto}
.intro-symbol.s1{top:12%;left:12%;transform:rotate(-12deg)}
.intro-symbol.s2{top:50%;right:10%;transform:rotate(8deg)}
.intro-symbol.s3{bottom:18%;left:42%;transform:rotate(4deg)}
.intro-vignette{position:absolute;inset:0;pointer-events:none;background:radial-gradient(120% 85% at 50% 35%, transparent 55%, rgba(0,0,0,.55) 100%);z-index:0}
.intro-light{position:absolute;inset:0;pointer-events:none;z-index:0;background:linear-gradient(115deg, transparent 0 45%, rgba(255,255,255,.06) 50%, transparent 55%),radial-gradient(60% 90% at 50% 10%, rgba(255,255,255,.03), transparent 60%);mix-blend-mode:screen;animation:sweep 8s ease-in-out infinite}
@keyframes sweep{0%{transform:translateX(-30%) skewX(-6deg);opacity:.5}50%{transform:translateX(30%) skewX(-6deg);opacity:.25}100%{transform:translateX(-30%) skewX(-6deg);opacity:.5}}
.intro-dust{position:absolute;inset:0;pointer-events:none;z-index:0;background:radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.06), transparent 60%),radial-gradient(1.8px 1.8px at 70% 20%, rgba(255,255,255,.05), transparent 60%),radial-gradient(1.5px 1.5px at 40% 70%, rgba(255,255,255,.04), transparent 60%),radial-gradient(2.2px 2.2px at 80% 60%, rgba(255,255,255,.05), transparent 60%);filter:blur(.2px);animation:dustFloat 22s linear infinite;opacity:.45}
@keyframes dustFloat{0%{background-position:0 0,0 0,0 0,0 0}100%{background-position:120px -80px,-100px 90px,80px 120px,-140px -120px}}
.intro-content{text-align:center;position:relative;z-index:1}
.intro-content h1{font-size:3rem;margin-bottom:20px;text-shadow:0 0 6px rgba(255,255,255,.15),0 4px 18px rgba(0,0,0,.6);animation:titlePulse 4s ease-in-out infinite}
@keyframes titlePulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.08)}}
.intro-lead{margin:6px auto 10px;max-width:56ch;text-align:center;font-size:1.25rem;line-height:1.55;color:#e7e3d7;opacity:.92;text-shadow:0 1px 10px rgba(0,0,0,.35)}
.enigmatic{font-size:1.25rem;font-style:italic;color:var(--accent);min-height:36px;margin:8px 0 26px;text-align:center;position:relative}
.enigmatic::after{content:"";display:inline-block;width:10px;height:1.1em;margin-left:2px;background:currentColor;opacity:.6;animation:cursorBlink 1s steps(1) infinite}
@keyframes cursorBlink{0%,50%{opacity:.6}50.01%,100%{opacity:0}}
.btn-glow{border:2px solid var(--accent);box-shadow:0 0 8px rgba(215,178,109,.55),0 0 24px rgba(215,178,109,.2) inset;transition:transform .14s ease, box-shadow .25s ease, border-color .25s ease}
.btn-glow:hover{transform:translateY(-2px) scale(1.03);border-color:#fff;box-shadow:0 0 10px rgba(255,255,255,.8),0 0 24px rgba(255,255,255,.35) inset}

/* ==== Pista 1 ==== */
.diario{background:rgba(0,0,0,.25);padding:16px;border-radius:10px;font-size:1.05rem}
[data-letter]{cursor:pointer;border-bottom:1px dashed rgba(255,255,255,.25)}
[data-letter]:hover{color:var(--accent)}
.selected{color:var(--accent)}
.progress{margin:12px 0 16px;opacity:.9}

/* ==== Pista 2 ==== */
.espelho-area{display:flex;flex-direction:column;align-items:center;width:100%;max-width:900px;margin:20px auto}
.espelho-linha{display:flex;justify-content:center;align-items:center;width:100%;gap:0}
.espelho-linha img{flex:1;max-width:20%;height:auto;object-fit:cover;display:block;margin:0;padding:0;border:none;transition:opacity .45s ease}
#palavraEspelhoMirror{margin-bottom:10px;transform:scaleX(-1);color:rgba(255,255,255,0.9);text-shadow:0 2px 6px rgba(0,0,0,0.4);font-weight:800;letter-spacing:.08em;text-transform:uppercase;font-size:clamp(28px,6vw,56px);opacity:1;transition:opacity .45s ease;text-align:center}
#palavraEspelhoMirror.hide{opacity:0!important}
#palavraEspelho{margin-top:10px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;font-size:clamp(28px,6vw,56px);color:var(--accent);opacity:0;transition:opacity .45s ease;text-align:center}

/* ==== Pista 3 ==== */
#equacao{text-align:center;font-size:1.6rem;font-weight:700;margin-bottom:12px;color:var(--accent)}
.timer{display:flex;gap:10px;justify-content:center;align-items:baseline;margin:6px 0 12px}
#timerLabel{opacity:.85}
#timerValue{font-weight:800;font-size:1.6rem;padding:2px 8px;border-radius:8px;background:rgba(255,255,255,.06)}
.timer.warning #timerValue{color:#ff6b6b;animation:pulse 1s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
.mystery{position:relative;min-height:60px;overflow:hidden;text-align:center;margin-bottom:10px}
.mystery .msg{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:2rem;font-weight:800;color:#ff4c4c;letter-spacing:1px;text-shadow:0 0 8px rgba(255,0,0,0.6);animation:fadeBlink 1s ease-in-out infinite alternate,moveMsg 6s ease-in-out forwards;white-space:nowrap}
@keyframes fadeBlink{0%,100%{opacity:1}50%{opacity:.2}}
@keyframes moveMsg{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-60%,-40%) scale(1.1)}100%{transform:translate(-40%,-60%) scale(1)}}
.clock{display:flex;gap:14px;align-items:center;justify-content:center;margin:14px 0}
.clock label{display:flex;flex-direction:column;gap:6px}
.clock select{padding:10px 12px;border-radius:8px;border:1px solid #fff;background:#000;color:#fff;font-size:1.05rem}

/* ==== Pista 4 (Puzzle) ==== */
.puzzle{
  width:min(520px, 92vw);
  aspect-ratio: 1 / 1;
  margin: 12px auto 6px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
}
.piece{
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  /* background-size é definido por JS para evitar cortes */
  background-repeat: no-repeat;
  box-shadow: 0 2px 10px rgba(0,0,0,.35);
  cursor: pointer;
  transition: transform .06s ease;
  outline: 1px dashed rgba(255,255,255,.12);
  background-color:#000; /* base neutra enquanto carrega a imagem */
}
.piece:active{ transform: scale(.98); }
.piece.correct{ outline-color: rgba(151, 241, 151, .7); }
.piece.selected{ box-shadow: 0 0 0 2px var(--accent) inset, 0 0 12px rgba(215,178,109,.55); }

/* ==== Final ==== */
.ok{color:#9be49b;font-weight:600;font-size:1.05rem}
.err{color:#ffb3b3;font-weight:600;font-size:1.05rem}
.ticket{border:2px dashed rgba(255,255,255,.6);border-radius:12px;padding:16px;margin:12px 0 20px;background:rgba(0,0,0,.25);font-size:1.05rem}
.ticket .row{display:flex;gap:26px;flex-wrap:wrap;margin:8px 0}
.label{opacity:.8;font-size:1rem}
.value{font-size:1.3rem;font-weight:700}
.countdown{display:flex;gap:12px;align-items:baseline;margin:10px 0 0}
#count{font-size:1.8rem;font-weight:800}

/* ==== Modal vídeo ==== */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;z-index:1000}
.modal.hidden{display:none}
.modal-content{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center}
.modal-content video{width:100%;height:100%;object-fit:contain;background:#000}
.close{position:absolute;top:15px;right:20px;color:#fff;font-size:28px;font-weight:bold;cursor:pointer;z-index:1001}
.close:hover{color:var(--accent)}

/* ==== Gate (PIN + numpad) ==== */
.gate-card{text-align:center;width:min(560px,92vw)}
.gate-input{display:flex;gap:10px;justify-content:center;align-items:center;margin:14px 0 12px}
#gateCode{font-size:1.8rem;letter-spacing:.25em;text-align:center;width:210px;padding:10px 12px;border-radius:10px;border:1.5px solid #fff;background:#000;color:#fff}
#gateCode::placeholder{color:rgba(255,255,255,.35);letter-spacing:.2em}
.numpad{display:grid;grid-template-columns:repeat(3,70px);gap:10px;justify-content:center;margin:10px auto 6px}
.np{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.45);color:#fff;font-weight:700;font-size:1.2rem;width:70px;height:56px;border-radius:10px;cursor:pointer;transition:.15s}
.np:hover{transform:translateY(-1px);border-color:var(--accent);color:var(--accent)}
.np-aux{font-size:1rem;opacity:.9}

/* Boarding pass (foto real) */
.ticket-photo{
  margin: 14px 0 18px;
  display: flex;
  justify-content: center;
}
.ticket-photo img{
  display: block;
  width: min(100%, 980px);
  max-height: 70vh;
  object-fit: cover;
  border-radius: 12px;
  box-shadow: 0 10px 36px rgba(0,0,0,.55);
}
.ticket-actions{
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

/* imagem dentro do modal (reduzida) */
.modal-content img {
  width: 70%;          /* 100% - 30% = 70% do tamanho original */
  max-width: 800px;    /* não deixar passar muito grande em ecrãs largos */
  height: auto;
  display: block;
  margin: 0 auto;      /* centraliza horizontalmente */
  border-radius: 6px;
}
/* Modal: fundo escuro para esconder o resto */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.9); /* escurece fundo */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
}

.modal.hidden {
  display: none;
}

/* Conteúdo do modal */
.modal-content {
  position: relative;
  background: transparent;
  border-radius: 10px;
  padding: 10px;
  max-width: 900px;
  width: 100%;
  text-align: center;
}

/* Foto da tripulação: limita altura */
.modal-content img {
  width: 70%;          /* mantém a largura */
  max-height: 70vh;    /* ocupa no máximo 70% da altura da janela */
  height: auto;
  display: block;
  margin: 0 auto;
  border-radius: 6px;
  object-fit: contain; /* mantém proporções */
}

/* Botão de fechar */
.close {
  position: absolute;
  right: 12px;
  top: 6px;
  font-size: 28px;
  cursor: pointer;
  color: #fff;
}

/* Modal: ocupa o ecrã inteiro e ofusca o fundo */
.modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.95); /* fundo bem escuro */
  z-index: 1000;
  backdrop-filter: blur(3px); /* opcional: desfoca o fundo */
}

.modal.hidden {
  display: none;
}

/* Conteúdo do modal: só a imagem e o botão fechar */
.modal-content {
  position: relative;
  background: transparent;
  border-radius: 10px;
  padding: 0;
  max-width: 900px;
  width: 100%;
  text-align: center;
}

/* Foto da tripulação: controla altura e largura */
.modal-content img {
  width: auto;
  max-width: 80%;
  max-height: 75vh; /* limita altura */
  height: auto;
  border-radius: 10px;
  box-shadow: 0 0 25px rgba(0,0,0,0.7);
}

/* Botão de fechar no canto */
.close {
  position: absolute;
  right: 12px;
  top: 12px;
  font-size: 30px;
  font-weight: bold;
  cursor: pointer;
  color: #fff;
  text-shadow: 0 0 8px rgba(0,0,0,0.8);
}


/* responsive */
@media (max-width:600px){
  h1,h2{font-size:1.8rem}
  p{font-size:1rem}
  .btn{font-size:.95rem;padding:10px 16px}
  .espelho-linha{flex-wrap:wrap}
  .espelho-linha img{max-width:50%}
}
